kind: pipeline
type: docker
name: docker-test

platform:
  os: linux
  arch: amd64
node:
  arch: s390x

steps:
- name: build
  image: bash:alpine3.14
  commands:
  - ls -la
  - echo "This is a test"

- name: step to fail
  image: bash:alpine3.14
  commands:
  - unknown_command

- name: test2
  image: bash:alpine3.14
  commands:
  - ls -la
  - echo "This is a test"

- name: slack
  image: luistt/drone-images:v0.0.3-slack-s390x
  pull: if-not-exists
  settings:
    webhook:
      from_secret: slack_webhook
    channel: general
    link_names: true
    template: >
        build {{build.number}} failed. It took {{since build.started}} {{build.link}}
  when:
    status:
      - failure

volumes:
- name: docker
  host:
    path: /var/run/docker.sock
- name: certs
  host:
    path: /var/lib/drone
